package StepDefinations;

import java.awt.AWTException;
import java.awt.Robot;
import java.awt.event.KeyEvent;
import java.io.IOException;
import java.util.ArrayList;
import java.util.Properties;

import org.openqa.selenium.By;
import org.openqa.selenium.JavascriptExecutor;
import org.openqa.selenium.Keys;
import org.openqa.selenium.WebDriver;
import org.openqa.selenium.WebElement;
import org.openqa.selenium.support.ui.ExpectedConditions;
import org.openqa.selenium.support.ui.WebDriverWait;
import org.testng.Assert;
import org.testng.annotations.Test;

import genericLib.PropertyFile;
import pomPages.comSignUpPage;

public class signup {
	
	WebDriver driver=null;
	PropertyFile p=new PropertyFile();
	@Test(priority=0)
	public void  SignUpAsCompany() throws InterruptedException, IOException, AWTException {
		comSignUpPage cs = new comSignUpPage(driver);
		cs.signUpLink.click();
		JavascriptExecutor js = (JavascriptExecutor) driver;
		js.executeScript("arguments[0].scrollIntoView(true);", cs.CompanySignUp);
		Thread.sleep(500); 
		cs.CompanySignUp.click();
		cs.CompanyName.sendKeys(p.getPropertyFiledata("CompanyName"));
		System.out.println(p.getPropertyFiledata("CompanyName"));
		cs.searchIndustryType.sendKeys(p.getPropertyFiledata("INdustryType"));
		Thread.sleep(2000);
		cs.selectCompany.click();
		cs.Contactname.sendKeys(p.getPropertyFiledata("Contactname"));
		String name = p.getPropertyFiledata("Contactname");
		cs.email.sendKeys(""+name+"@yopmail.com");
		String emailidCopy = ""+name+"@yopmail.com";
		System.out.println(emailidCopy);
		cs.phone.sendKeys(p.getPropertyFiledata("phone"));
		cs.password.sendKeys(p.getPropertyFiledata("password"));
		String passwordprint = p.getPropertyFiledata("password");
		System.out.println(passwordprint);
		cs.ConfirmPassword.sendKeys(p.getPropertyFiledata("password"));
		js.executeScript("arguments[0].scrollIntoView(true);", cs.Checkbox);
		Thread.sleep(500);
		cs.Checkbox.click();
		Thread.sleep(500);
		cs.signUpNowBtn.click();
		
		WebElement Verification = new WebDriverWait(driver,10)
				.until(ExpectedConditions.visibilityOfElementLocated(By.xpath("//h1[normalize-space()='OTP Verification']")));
		String VerificationText = Verification.getText();
		Assert.assertEquals(VerificationText, "OTP Verification");
		Thread.sleep(1000);
		
		Thread.sleep(1000);
		Robot robot = new Robot();
		robot.keyPress(KeyEvent.VK_CONTROL);
		robot.keyPress(KeyEvent.VK_T);
		robot.keyRelease(KeyEvent.VK_T);
		robot.keyRelease(KeyEvent.VK_CONTROL);
		Thread.sleep(1000);
		
//		String originalHandle = driver.getWindowHandle();
		// Switch to the new tab
		ArrayList<String> tabs = new ArrayList<String>(driver.getWindowHandles());
		driver.switchTo().window(tabs.get(1));

		Thread.sleep(1000);
		driver.get("https://yopmail.com/");
		WebElement yopmail = driver.findElement(By.xpath("//input[@id='login']"));
		yopmail.sendKeys(""+name+"@yopmail.com",Keys.ENTER);
		Thread.sleep(1000);
		
		
		WebElement iframeElement = driver.findElement(By.id("ifmail"));		//driver.switchTo().frame("id of the element");
		driver.switchTo().frame(iframeElement);
		WebElement Verification1 = new WebDriverWait(driver,10)
				.until(ExpectedConditions.visibilityOfElementLocated(By.xpath("(//b[normalize-space()='Dear user'])[1]")));
		
		String VerificationText1 = Verification1.getText();
		Assert.assertEquals(VerificationText1, "Dear user");
		Thread.sleep(1000);
		
		WebElement otp = driver.findElement(By.xpath("/html[1]/body[1]/main[1]/div[1]/div[1]/div[1]/div[2]/div[1]/div[1]/h1[1]"));
		js.executeScript("arguments[0].scrollIntoView(true);", otp);
		Thread.sleep(500);
		String getOTP = otp.getText();
		System.out.println(getOTP);
		Thread.sleep(1000);
		driver.switchTo().defaultContent();
		
		driver.switchTo().window(tabs.get(0));
		WebElement EnterOtp = driver.findElement(By.xpath("//input[@aria-label='Please enter verification code. Digit 1']"));
		EnterOtp.click();
		EnterOtp.sendKeys(getOTP);
		Thread.sleep(500);
		WebElement Verify = driver.findElement(By.xpath("//button[normalize-space()='Verify']"));
		Verify.click();
		Thread.sleep(500);
		WebElement ContinueToLogin = driver.findElement(By.xpath("//button[normalize-space()='continue to login']"));
		ContinueToLogin.click();
		
	Thread.sleep(3000);
	
	}

}
